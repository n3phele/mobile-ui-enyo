<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>QUnit basic example</title>
<link rel="stylesheet" href="qunit-1.11.0.css">
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script src="qunit-1.11.0.js"></script>

<!-- ENYO resources -->
<script src="../enyo/enyo.js" type="text/javascript"></script>
<script src="../lib/layout/package.js" type="text/javascript"></script>
<script src="../lib/onyx/package.js" type="text/javascript"></script>
<script src="../lib/onyx/source/wip-package.js" type="text/javascript"></script>

<script src="../base64.js" type="text/javascript"></script>
<script src="../n3pheleClient.js" type="text/javascript"></script>
<script src="../generalFunctions.js" type="text/javascript"></script>

<script>

var enyoAjaxFactory = new Object();
var enyoAjax = new Object();
enyoAjaxFactory.create = function(a) { return enyoAjax; };
enyoAjax.error = function() { }
enyoAjax.response = function(o, func) { func( enyoAjax, {"stamp":"1364832379405","changeGroup":{"stamp":"1364832379405","change":[{"stamp":"1364832379405","uri":"https://n3phele-dev.appspot.com/resources/process/182001","deleted":"false","owner":"https://n3phele-dev.appspot.com/resources/user/154001","public":"false"},{"stamp":"1364832379400","uri":"https://n3phele-dev.appspot.com/resources/process/182001_1","deleted":"false","owner":"https://n3phele-dev.appspot.com/resources/user/154001","public":"false"},{"stamp":"1364832379403","uri":"https://n3phele-dev.appspot.com/resources/action/181001","deleted":"false","owner":"https://n3phele-dev.appspot.com/resources/user/154001","public":"false"}]},"changeCount":"3","cacheAvailable":"true"}); return enyoAjax; }
enyoAjax.go = function() { return enyoAjax; }

var n3pheleClient = new N3pheleClient(enyoAjaxFactory);
	
asyncTest( "list new updates and get the desired one", function() {
	
	//Execution on success should return object. Direct comparison was bad ordered, comparing two important fields.
	var success = function (change) {
		equal( change.uri, "https://n3phele-dev.appspot.com/resources/process/182001" );
		equal( change.owner, "https://n3phele-dev.appspot.com/resources/user/154001" );
		start();
	}
	
	var error = function() 	{
		ok(false, "should not got here, call throw error");
		start();
	}
	
	n3pheleClient.getChangesSince('1364832379405', "https://n3phele-dev.appspot.com/resources/process/182001", success, error);
});

asyncTest( "list new updates and none was desired", function() {
	
	//Execution on success should return object.
	var success = function (change) {
		ok(false, "will not get here since no change will be passed");
		start();
	}
	
	var error = function() 	{
		ok(false, "should not got here, call throw error");
		start();
	}
	
	//No assertion should be throw
	expect(0);	
	n3pheleClient.getChangesSince('1364832379405', "https://n3phele-dev.appspot.com/resources/process/15000", success, error);
	window.setTimeout(start, 100);	
});

</script>
</body>
</html>